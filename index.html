<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lagu De Unn Translator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .translation-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #3b82f6;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .language-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            line-height: 1rem;
            font-weight: 500;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: #e2e8f0;
        }
        body.dark-mode .translation-card {
            background: rgba(45, 55, 72, 0.8);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            color: #e2e8f0;
        }
        body.dark-mode .text-gray-800 {
            color: #e2e8f0;
        }
        body.dark-mode .text-gray-600 {
            color: #cbd5e0;
        }
        body.dark-mode .text-gray-700 {
            color: #cbd5e0;
        }
        body.dark-mode .border-gray-300 {
            border-color: #4a5568;
        }
        body.dark-mode .bg-gray-100 {
            background-color: #4a5568;
        }
        body.dark-mode .text-gray-500 {
            color: #a0aec0;
        }
        body.dark-mode .bg-white {
            background-color: #2d3748;
        }
        body.dark-mode .bg-white.bg-opacity-50 {
            background-color: rgba(45, 55, 72, 0.5);
        }
        body.dark-mode input, body.dark-mode button {
            color: #e2e8f0;
        }
        body.dark-mode input::placeholder {
            color: #a0aec0;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">
                Lagu De Unn Translator
            </h1>
            <p class="text-gray-600">
                Upload or provide a CSV URL to automatically translate sentences
            </p>
        </div>

        <div class="translation-card rounded-xl p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-4 mb-6">
                <div class="w-full">
                    <label for="csv-url" class="block text-sm font-medium text-gray-700 mb-1">
                        CSV File URL
                    </label>
                    <div class="flex">
                        <input
                            type="text"
                            id="csv-url"
                            placeholder="https://example.com/translations.csv"
                            class="flex-1 rounded-l-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <button
                            onclick="loadCSV()"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-r-md transition-colors"
                        >
                            Load
                        </button>
                    </div>
                </div>
                <div class="w-full">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Or Upload CSV
                    </label>
                    <input
                        type="file"
                        id="file-upload"
                        accept=".csv"
                        class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                    />
                </div>
            </div>

            <div id="loading-indicator" class="hidden text-center py-4">
                <div class="loader mx-auto"></div>
                <p class="mt-2 text-gray-600">Loading and processing CSV file...</p>
            </div>

            <div id="error-message" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded"></div>
        </div>

        <div class="translation-card rounded-xl p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Translate a Sentence</h2>
            <div class="flex flex-col md:flex-row gap-4 mb-4">
                <div class="flex-1">
                    <input
                        type="text"
                        id="sentence-input"
                        placeholder="Enter sentence to translate..."
                        class="w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                </div>
                <button
                    onclick="translateSentence()"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-colors"
                >
                    Translate
                </button>
            </div>

            <div id="translation-result" class="hidden mt-6">
                <h3 class="text-lg font-medium text-gray-800 mb-2">Translation Result</h3>
                <div class="flex flex-col gap-3">
                    <div class="flex items-start gap-3">
                        <span class="language-badge bg-blue-100 text-blue-800">Original</span>
                        <p id="original-sentence" class="text-gray-700"></p>
                    </div>
                    <div class="flex items-start gap-3">
                        <span class="language-badge bg-purple-100 text-purple-800">Translated</span>
                        <p id="translated-sentence" class="text-gray-700"></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="translation-card rounded-xl p-6 mb-8" id="csv-content-display">
            
        <!-- Add this new section for translation history -->
        <div class="translation-card rounded-xl p-6 mb-8" id="translation-history">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Translation History</h2>
            <div id="history-list" class="space-y-2">
                <!-- Will be populated by JS -->
            </div>
        </div>
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-800">CSV Content</h2>
                <button
                    onclick="downloadCSV()"
                    id="download-btn"
                    class="hidden bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors"
                >
                    Download Processed CSV
                </button>
            </div>
            <div id="csv-table" class="overflow-x-auto"></div>
        </div>
    </div>

    <script>
        let translationsData = {};
        let translationMemory = []; // Stores past translations
        
        // DOM elements
        const csvUrlInput = document.getElementById('csv-url');
        const fileUpload = document.getElementById('file-upload');
        const loadingIndicator = document.getElementById('loading-indicator');
        const errorMessage = document.getElementById('error-message');
        const sentenceInput = document.getElementById('sentence-input');
        const translationResult = document.getElementById('translation-result');
        const originalSentenceEl = document.getElementById('original-sentence');
        const translatedSentenceEl = document.getElementById('translated-sentence');
        const csvTable = document.getElementById('csv-table');
        const downloadBtn = document.getElementById('download-btn');
        const csvContentDisplay = document.getElementById('csv-content-display');

        // Load CSV from URL or file upload
        function loadCSV() {
            const url = csvUrlInput.value.trim();
            const file = fileUpload.files[0];
            
            errorMessage.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            
            if (url) {
                loadFromUrl(url);
            } else if (file) {
                loadFromFile(file);
            } else {
                // Automatically try to load translator.csv from the same directory
                loadFromUrl('translator.csv'); 
            }
        }

        // Load CSV from URL
        async function loadFromUrl(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const csvText = await response.text();
                processCSV(csvText);
            } catch (error) {
                showError(`Failed to load CSV: ${error.message}`);
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        // Load CSV from file upload
        function loadFromFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                processCSV(e.target.result);
                loadingIndicator.classList.add('hidden');
            };
            reader.onerror = function() {
                showError('Error reading file');
                loadingIndicator.classList.add('hidden');
            };
            reader.readAsText(file);
        }

        // Process CSV data
        function processCSV(csvText) {
            try {
                // Parse CSV (assuming header row exists)
                const lines = csvText.split('\n');
                const headers = lines[0].split(',');
                
                // Find index of relevant columns (source and target language)
                const sourceIndex = headers.findIndex(h => h.toLowerCase().includes('english') || h.toLowerCase().includes('source'));
                const targetIndex = headers.findIndex(h => h.toLowerCase().includes('lagu') || h.toLowerCase().includes('target'));
                
                if (sourceIndex === -1 || targetIndex === -1) {
                    throw new Error('Could not find required columns (English/Source and Lagu/Target)');
                }
                
                // Create translation dictionary
                translationsData = {};
                for (let i = 1; i < lines.length; i++) {
                    if (!lines[i].trim()) continue;
                    
                    const cells = lines[i].split(',');
                    if (cells.length > Math.max(sourceIndex, targetIndex)) {
                        const source = cells[sourceIndex].trim().toLowerCase();
                        const target = cells[targetIndex].trim().toLowerCase();
                        translationsData[source] = target;
                    }
                }
                
                // Display sample of CSV content
                displayCSVContent(lines.slice(0, Math.min(10, lines.length)));
                
                downloadBtn.classList.remove('hidden');
                csvContentDisplay.classList.remove('hidden');
                
            } catch (error) {
                showError(`Error processing CSV: ${error.message}`);
            }
        }

        // Display CSV content in a table
        function displayCSVContent(lines) {
            if (lines.length === 0) {
                csvTable.innerHTML = '<p class="text-gray-500">No data found in CSV</p>';
                return;
            }
            
            const headers = lines[0].split(',');
            const rows = lines.slice(1);
            
            let html = `
                <table class="min-w-full bg-white rounded-lg overflow-hidden">
                    <thead class="bg-gray-100">
                        <tr>
                            ${headers.map(h => `<th class="px-4 py-2 text-left text-gray-700">${h}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody class="text-gray-600">
            `;
            
            for (let i = 0; i < Math.min(5, rows.length); i++) {
                if (!rows[i].trim()) continue;
                
                const cells = rows[i].split(',');
                html += '<tr class="border-t border-gray-200">';
                
                for (let j = 0; j < headers.length; j++) {
                    const cellContent = cells[j] ? cells[j].trim() : '';
                    html += `<td class="px-4 py-2">${cellContent}</td>`;
                }
                
                html += '</tr>';
            }
            
            html += `
                    </tbody>
                </table>
                ${rows.length > 5 ? `<p class="mt-2 text-sm text-gray-500">Showing 5 of ${rows.length} rows</p>` : ''}
            `;
            
            csvTable.innerHTML = html;
        }

        // Translate sentence using loaded dictionary
        function translateSentence() {
            const sentence = sentenceInput.value.trim();
            if (!sentence) {
                showError('Please enter a sentence to translate');
                return;
            }
            
            if (Object.keys(translationsData).length === 0) {
                showError('No translation dictionary loaded. Please load a CSV first.');
                return;
            }
            
            // Simple translation - look up each word
            const words = sentence.toLowerCase().split(/\s+/);
            const translatedWords = words.map(word => {
                // Simple match
                if (translationsData[word]) {
                    return translationsData[word];
                }
                
                // Try removing common suffixes
                const baseWord = word.replace(/('s|s|ing|ed|er|est)$/, '');
                if (translationsData[baseWord]) {
                    return translationsData[baseWord];
                }
                
                // Unknown word
                return `[${word}]`;
            });
            
            const translation = translatedWords.join(' ');
            originalSentenceEl.textContent = sentence;
            translatedSentenceEl.textContent = translation;
            translationResult.classList.remove('hidden');
            
            // Store in memory
            translationMemory.push({
                original: sentence,
                translated: translation,
                timestamp: new Date().toISOString()
            });
            updateHistoryDisplay(); // Update history after each translation
        }

        // Download processed CSV
        function downloadCSV() {
            if (Object.keys(translationsData).length === 0) {
                showError('No translation data to download');
                return;
            }
            
            let csvContent = "English,Lagu\n";
            for (const [eng, lagu] of Object.entries(translationsData)) {
                csvContent += `${eng},${lagu}\n`;
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'translations.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Update translation history display
        function updateHistoryDisplay() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = translationMemory.map(item => `
                <div class="bg-white bg-opacity-50 p-3 rounded-md">
                    <div class="flex justify-between text-sm text-gray-500">
                        <span>${new Date(item.timestamp).toLocaleString()}</span>
                    </div>
                    <div class="mt-1 flex items-start gap-3">
                        <span class="language-badge bg-blue-100 text-blue-800">Original</span>
                        <p class="text-gray-700">${item.original}</p>
                    </div>
                    <div class="mt-1 flex items-start gap-3">
                        <span class="language-badge bg-purple-100 text-purple-800">Translated</span>
                        <p class="text-gray-700">${item.translated}</p>
                    </div>
                </div>
            `).join('');
        }

        // Show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set dark mode by default
            document.body.classList.add('dark-mode');
            updateHistoryDisplay();
            loadCSV(); // Automatically load CSV on page load
        });

        // Event listeners
        fileUpload.addEventListener('change', function() {
            csvUrlInput.value = '';
        });

        csvUrlInput.addEventListener('input', function() {
            fileUpload.value = '';
        });

        sentenceInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                translateSentence();
            }
        });
    </script>
</body>
</html>
